<?php
header('Content-Type: text/plain');

$agentId = $_GET['val'] ?? ''; // = host_name

if (!$agentId) {
    echo "P : 대기중"; // 기본 대기중 처리
    exit;
}

require_once __DIR__ . '/../config/database.php';
$db = (new Database())->pdo;

$sql = "SELECT exter_status FROM externally_info 
        WHERE host_name = :host_name 
        ORDER BY create_date DESC 
        LIMIT 1";
$stmt = $db->prepare($sql);
$stmt->bindValue(':host_name', $agentId);
$stmt->execute();

$status = $stmt->fetchColumn();

switch ($status) {
    case '허용':
        echo "A : 허용";
        break;
    case '반려':
        echo "D : 반려";
        break;
    default:
        echo "P : 대기중";
        break;
}
?>